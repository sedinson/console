<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Soluntech - Admin Console</title>

    <!-- Core CSS - Include with every page -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="css/alarmize.jquery.css" />
    <link rel="shortcut icon" type="image/png" href="css/imgs/favicon.png"/>
    <link rel="shortcut icon" type="image/png" href="css/imgs/favicon.png"/>

    <!-- Page-Level Plugin CSS - Blank -->

    <!-- SB Admin CSS - Include with every page -->
    <link href="css/sb-admin.css" rel="stylesheet">

</head>

<body>

    <div id="wrapper">

        <nav class="navbar navbar-default navbar-fixed-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="welcome.html">
                    <h1 id="logo">Soluntech - Console</h1>
                </a>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right">
                <!-- /.dropdown -->
                <li><a id="stateServices">Servicio [On]</a></li>
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="profile.html"><i class="fa fa-user fa-fw"></i> Editar Perfil</a>
                        </li>
                        <li><a href="settings.html"><i class="fa fa-gear fa-fw"></i> Configurar</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="javascript:logout();"><i class="fa fa-sign-out fa-fw"></i> Finalizar Sesión</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
            <!-- /.navbar-top-links -->

            <div class="navbar-default navbar-static-side" role="navigation">
                <div class="sidebar-collapse">
                    <ul class="nav" id="side-menu">
                        <li class="sidebar-search">
                            <div class="input-group custom-search-form">
                                <input type="text" class="form-control" placeholder="Search...">
                                <span class="input-group-btn">
                                <button class="btn btn-default" type="button">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                            </div>
                            <!-- /input-group -->
                        </li>
                        <li>
                            <a href="welcome.html"><i class="glyphicon glyphicon-dashboard"></i> Instancias</a>
                            <a href="alarmas.html"><i class="glyphicon glyphicon-flash"></i> Alarmas</a>
                        </li>
                    </ul>
                    <!-- /#side-menu -->
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper">
            <div id="alarms-page">
                <div class="row">
                    <div class="col-lg-12">
                        <h1 class="page-header">Alarmas Programadas</h1>
                    </div>
                    <!-- /.col-lg-12 -->
                </div>
                <!-- /.row -->
                
                <div class="row">
                    <div class="col-lg-12" id="alarmsWork">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="active"><a href="#cpu" role="tab" data-toggle="tab">Consumo CPU</a></li>
                            <!-- <li><a href="#billing" role="tab" data-toggle="tab">Consumo de Dinero</a></li> -->
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active">
                                <!-- <br>
                                <div class="table-responsive">
                                    <table class="table tablesorter table-striped table-bordered table-hover" id="table-alarms">
                                        <thead>
                                            <tr>
                                                <th>Insancia</th>
                                                <th>Nombre</th>
                                                <th>Estado</th>
                                            </tr>
                                        </thead>
                                        <tbody></tbody>
                                    </table>
                                </div> -->
                                <br>
                                <div class="panel-group">
                                    <div class="panel panel-default" id="cpu"></div>
                                </div>
                            </div>
                            <div class="tab-pane" id="billing">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- Modal by Default -->
    <div id="myModal" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="mySmallModalLabel">Console - Soluntech</h4>
                </div>
                <div class="modal-body">
                    <p class="contex-text"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Ok</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Core Scripts - Include with every page -->
    <script src="js/jquery-1.10.2.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/jquery.tablesorter.min.js"></script>

    <!-- Page-Level Plugin Scripts - Blank -->

    <script src="js/projectbase.js"></script>

    <!-- SB Admin Scripts - Include with every page -->
    <script src="js/sb-admin.js"></script>
    <script src="js/alarmize.jquery.js"></script>
    
    <script>
        $('#stateServices').text('Servicio [Off]');

        var Alarms = {
            list: {},
            selected: null,
            load: function () {
                uget({
                    url: LinkServer.Url('alarm', 'get')
                }).done(function (data) {
                    $('#stateServices').text('Servicio [On]');
                    console.log('Servicio [On]');
                    if(data._code === 200) {
                        var cpu = $("#cpu");
                        cpu.empty();
                        // cpu.append('<br>');

                        var billing = $("#billing");
                        billing.empty();
                        billing.append('<br>');
                        var html = "";

                        for (var i = 0; i <= data._response.length; i++){
                            if(data._response[i]['Namespace'] == 'AWS/EC2'){

                                var tempButton = "";

                                switch(data._response[i]['StateValue']){
                                    case "OK":
                                        tempButton += '<div class="alert alert-success" role="alert" style="padding:2px; margin:0; float:right; margin-top:-3px;"><i class="glyphicon glyphicon-exclamation-sign"></i> Ok</div>';
                                        break;
                                    case "ALARM":
                                        tempButton += '<div class="alert alert-danger" role="alert" style="padding:2px; margin:0; float:right; margin-top:-3px;"><i class="glyphicon glyphicon-exclamation-sign"></i> Alarma</div>';
                                        break;
                                    case "INSUFFICIENT_DATA":
                                        tempButton += '<div class="alert alert-warning" role="alert" style="padding:2px; margin:0; float:right; margin-top:-3px;"><i class="glyphicon glyphicon-exclamation-sign"></i> Insuficiente</div>';
                                        break;
                                }

                                html = '<div class="panel-heading">'+
                                            '<h4 class="panel-title">'+
                                                tempButton +
                                                '<a data-toggle="collapse" data-parent="#accordion" href="#collapse'+ i +'">'+
                                                    data._response[i]['AlarmName'] +
                                                '</a>'+
                                            '</h4>' +
                                        '</div>'+
                                        '<div id="collapse'+ i +'" class="panel-collapse collapse">'+
                                            '<div class="panel-body">';

                                html += '<div class="well col-md-6 init">'+
                                    '<button type="button" class="close" onclick="AlarmDelete(\''+ data._response[i]['AlarmName'] +'\')"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><br>'+
                                    '<div class="form-group">'+
                                        '<div class="row">'+
                                            '<div class="col-md-6">'+
                                                '<label>Siempre que sea: </label>'+
                                                '<select class="form-control">';

                                switch(data._response[i]['Statistic']){
                                    case "Average":
                                        html += '<option selected value="Average">Promedio</option>'+
                                                '<option value="Minimum">Minimo</option>'+
                                                '<option value="Maximum">Maximo</option>'+
                                                '<option value="Sum">Total</option>'+
                                                '<option value="SampleCount">SampleCount</option>';
                                        break;
                                    case "Minimum":
                                        html += '<option value="Average">Promedio</option>'+
                                                '<option selected value="Minimum">Minimo</option>'+
                                                '<option value="Maximum">Maximo</option>'+
                                                '<option value="Sum">Total</option>'+
                                                '<option value="SampleCount">SampleCount</option>';
                                        break;
                                    case "Maximum":
                                        html += '<option value="Average">Promedio</option>'+
                                                '<option value="Minimum">Minimo</option>'+
                                                '<option selected value="Maximum">Maximo</option>'+
                                                '<option value="Sum">Total</option>'+
                                                '<option value="SampleCount">SampleCount</option>';
                                        break;
                                    case "Sum":
                                        html += '<option value="Average">Promedio</option>'+
                                                '<option value="Minimum">Minimo</option>'+
                                                '<option value="Maximum">Maximo</option>'+
                                                '<option selected value="Sum">Total</option>'+
                                                '<option value="SampleCount">SampleCount</option>';
                                        break;
                                    case "SampleCount":
                                        html += '<option value="Average">Promedio</option>'+
                                                '<option value="Minimum">Minimo</option>'+
                                                '<option value="Maximum">Maximo</option>'+
                                                '<option value="Sum">Total</option>'+
                                                '<option selected value="SampleCount">SampleCount</option>';
                                        break;
                                }
                                                    
                                html +=         '</select>'+
                                            '</div>'+
                                            '<div class="col-md-6">'+
                                                '<label>De:</label>'+
                                                '<select class="form-control">';

                                switch(data._response[i]['MetricName']){
                                    case "CPUUtilization":
                                        html += '<option selected value="CPUUtilization">Consumo de CPU</option>'+
                                                    '<option value="NetworkOut">Red sin Servicio</option>'+
                                                    '<option value="DiskReadBytes">Lectura Disco</option>'+
                                                    '<option value="DiskReadOps">Operaciones Lectura Disco</option>'+
                                                    '<option value="DiskWriteBytes">Operaciones Escritura Disco</option>'+
                                                    '<option value="NetworkIn">Red en Servicio</option>';
                                        break;
                                    case "NetworkOut":
                                        html += '<option value="CPUUtilization">Consumo de CPU</option>'+
                                                    '<option selected value="NetworkOut">Red sin Servicio</option>'+
                                                    '<option value="DiskReadBytes">Lectura Disco</option>'+
                                                    '<option value="DiskReadOps">Operaciones Lectura Disco</option>'+
                                                    '<option value="DiskWriteBytes">Operaciones Escritura Disco</option>'+
                                                    '<option value="NetworkIn">Red en Servicio</option>';
                                        break;
                                    case "DiskReadBytes":
                                        html += '<option value="CPUUtilization">Consumo de CPU</option>'+
                                                    '<option value="NetworkOut">Red sin Servicio</option>'+
                                                    '<option selected value="DiskReadBytes">Lectura Disco</option>'+
                                                    '<option value="DiskReadOps">Operaciones Lectura Disco</option>'+
                                                    '<option value="DiskWriteBytes">Operaciones Escritura Disco</option>'+
                                                    '<option value="NetworkIn">Red en Servicio</option>';
                                        break;
                                    case "DiskReadOps":
                                        html += '<option value="CPUUtilization">Consumo de CPU</option>'+
                                                    '<option value="NetworkOut">Red sin Servicio</option>'+
                                                    '<option value="DiskReadBytes">Lectura Disco</option>'+
                                                    '<option selected value="DiskReadOps">Operaciones Lectura Disco</option>'+
                                                    '<option value="DiskWriteBytes">Operaciones Escritura Disco</option>'+
                                                    '<option value="NetworkIn">Red en Servicio</option>';
                                        break;
                                    case "DiskWriteBytes":
                                        html += '<option value="CPUUtilization">Consumo de CPU</option>'+
                                                    '<option value="NetworkOut">Red sin Servicio</option>'+
                                                    '<option value="DiskReadBytes">Lectura Disco</option>'+
                                                    '<option value="DiskReadOps">Operaciones Lectura Disco</option>'+
                                                    '<option selected value="DiskWriteBytes">Operaciones Escritura Disco</option>'+
                                                    '<option value="NetworkIn">Red en Servicio</option>';
                                        break;
                                    case "NetworkIn":
                                        html += '<option value="CPUUtilization">Consumo de CPU</option>'+
                                                    '<option value="NetworkOut">Red sin Servicio</option>'+
                                                    '<option value="DiskReadBytes">Lectura Disco</option>'+
                                                    '<option value="DiskReadOps">Operaciones Lectura Disco</option>'+
                                                    '<option value="DiskWriteBytes">Operaciones Escritura Disco</option>'+
                                                    '<option selected value="NetworkIn">Red en Servicio</option>';
                                        break;
                                    default :
                                        html += '<option value="0">No estimado</option>';
                                }


                                html +=         '</select>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>'+
                                    '<div class="form-group">'+
                                        '<div class="row">'+
                                            '<div class="col-md-6">'+
                                                '<label>Es:</label>'+
                                                '<select class="form-control">';

                                switch(data._response[i]['ComparisonOperator']){
                                    case "GreaterThanThreshold":
                                        html += '<option selected value="GreaterThanThreshold">></option><option value="GreaterThanOrEqualToThreshold">>=</option><option value="LessThanThreshold"><</option><option value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                    case "GreaterThanOrEqualToThreshold":
                                        html += '<option value="GreaterThanThreshold">></option><option selected value="GreaterThanOrEqualToThreshold">>=</option><option value="LessThanThreshold"><</option><option value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                    case "LessThanThreshold":
                                        html += '<option value="GreaterThanThreshold">></option><option value="GreaterThanOrEqualToThreshold">>=</option><option selected value="LessThanThreshold"><</option><option value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                    case "LessThanOrEqualToThreshold":
                                        html += '<option value="GreaterThanThreshold">></option><option value="GreaterThanOrEqualToThreshold">>=</option><option value="LessThanThreshold"><</option><option selected value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                }

                                html +=         '</select>'+
                                            '</div>'+
                                            '<div class="col-md-6">'+
                                                '<label>Porcentaje:</label>'+
                                                '<input class="form-control" type="text" value="'+ data._response[i]['Threshold'].substring(0,data._response[i]['Threshold'].length-2) +'">'+
                                            '</div>'+
                                        '</div>'+  
                                    '</div>'+
                                    '<div class="form-group">'+
                                        '<div class="row">'+
                                            '<div class="col-md-6">'+
                                                '<label>Por lo menos:</label><br>'+
                                                '<input class="form-control" type="text" value="'+ data._response[i]['EvaluationPeriods'] +'">'+
                                            '</div>'+
                                            '<div class="col-md-6">'+
                                                '<label>Período(s) de</label>'+
                                                '<select class="form-control">';

                                switch(data._response[i]['Period']){
                                    case "60":
                                        html += '<option selected value="60">1 Minuto</option>'+
                                                '<option value="300">5 Minutos</option>'+
                                                '<option value="900">15 Minutos</option>'+
                                                '<option value="3600">1 Hora</option>'+
                                                '<option value="21600">6 Hora</option>'+
                                                '<option value="86400">1 Dia</option>';
                                        break;
                                    case '300':
                                        html += '<option value="60">1 Minuto</option>'+
                                                '<option selected value="300">5 Minutos</option>'+
                                                '<option value="900">15 Minutos</option>'+
                                                '<option value="3600">1 Hora</option>'+
                                                '<option value="21600">6 Hora</option>'+
                                                '<option value="86400">1 Dia</option>';
                                        break;
                                    case "900":
                                        html += '<option value="60">1 Minuto</option>'+
                                                '<option value="300">5 Minutos</option>'+
                                                '<option selected value="900">15 Minutos</option>'+
                                                '<option value="3600">1 Hora</option>'+
                                                '<option value="21600">6 Hora</option>'+
                                                '<option value="86400">1 Dia</option>';
                                        break;
                                    case "3600":
                                        html += '<option value="60">1 Minuto</option>'+
                                                '<option value="300">5 Minutos</option>'+
                                                '<option value="900">15 Minutos</option>'+
                                                '<option selected value="3600">1 Hora</option>'+
                                                '<option value="21600">6 Hora</option>'+
                                                '<option value="86400">1 Dia</option>';
                                        break;
                                    case "21600":
                                        html += '<option value="60">1 Minuto</option>'+
                                                '<option value="300">5 Minutos</option>'+
                                                '<option value="900">15 Minutos</option>'+
                                                '<option value="3600">1 Hora</option>'+
                                                '<option selected value="21600">6 Hora</option>'+
                                                '<option value="86400">1 Dia</option>';
                                        break;
                                    case "86400":
                                        html += '<option value="60">1 Minuto</option>'+
                                                '<option value="300">5 Minutos</option>'+
                                                '<option value="900">15 Minutos</option>'+
                                                '<option value="3600">1 Hora</option>'+
                                                '<option value="21600">6 Hora</option>'+
                                                '<option selected value="86400">1 Dia</option>';
                                        break;
                                }

                                html +=         '</select>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>'+
                                    '<div class="form-group">'+
                                        '<div class="row">'+
                                            '<div class="col-md-6">'+
                                                // '<input id="showComboxCpu" type="checkbox"> '+
                                                '<label>Realice la acción:</label>'+
                                                '<fieldset id="changeCombox">'+
                                                    '<select id="disabledSelect" class="form-control">';

                                switch(data._response[i]['OKActions'][0]){
                                    case "arn:aws:automate:us-east-1:ec2:stop":
                                        html += '<option selected value="arn:aws:automate:us-east-1:ec2:stop">Detener la instacia</option>'+
                                                '<option value="arn:aws:automate:us-east-1:ec2:terminate">Terminar la instacia</option>'+
                                                '<option value="arn:aws:sns:us-east-1:482407636571:NotifyMe">Notificarme</option>';
                                        break;
                                    case "arn:aws:automate:us-east-1:ec2:terminate":
                                        html += '<option value="arn:aws:automate:us-east-1:ec2:stop">Detener la instacia</option>'+
                                                '<option selected value="arn:aws:automate:us-east-1:ec2:terminate">Terminar la instacia</option>'+
                                                '<option value="arn:aws:sns:us-east-1:482407636571:NotifyMe">Notificarme</option>';
                                        break;
                                    case "arn:aws:sns:us-east-1:482407636571:NotifyMe":
                                        html += '<option value="arn:aws:automate:us-east-1:ec2:stop">Detener la instacia</option>'+
                                                '<option value="arn:aws:automate:us-east-1:ec2:terminate">Terminar la instacia</option>'+
                                                '<option selected value="arn:aws:sns:us-east-1:482407636571:NotifyMe">Notificarme</option>';
                                        break;
                                }

                                switch(data._response[i]['AlarmActions'][0]){
                                    case "arn:aws:automate:us-east-1:ec2:stop":
                                        html += '<option selected value="arn:aws:automate:us-east-1:ec2:stop">Detener la instacia</option>'+
                                                '<option value="arn:aws:automate:us-east-1:ec2:terminate">Terminar la instacia</option>'+
                                                '<option value="arn:aws:sns:us-east-1:482407636571:NotifyMe">Notificarme</option>';
                                        break;
                                    case "arn:aws:automate:us-east-1:ec2:terminate":
                                        html += '<option value="arn:aws:automate:us-east-1:ec2:stop">Detener la instacia</option>'+
                                                '<option selected value="arn:aws:automate:us-east-1:ec2:terminate">Terminar la instacia</option>'+
                                                '<option value="arn:aws:sns:us-east-1:482407636571:NotifyMe">Notificarme</option>';
                                        break;
                                    case "arn:aws:sns:us-east-1:482407636571:NotifyMe":
                                        html += '<option value="arn:aws:automate:us-east-1:ec2:stop">Detener la instacia</option>'+
                                                '<option value="arn:aws:automate:us-east-1:ec2:terminate">Terminar la instacia</option>'+
                                                '<option selected value="arn:aws:sns:us-east-1:482407636571:NotifyMe">Notificarme</option>';
                                        break;
                                }

                                switch(data._response[i]['InsufficientDataActions'][0]){
                                    case "arn:aws:automate:us-east-1:ec2:stop":
                                        html += '<option selected value="arn:aws:automate:us-east-1:ec2:stop">Detener la instacia</option>'+
                                                '<option value="arn:aws:automate:us-east-1:ec2:terminate">Terminar la instacia</option>'+
                                                '<option value="arn:aws:sns:us-east-1:482407636571:NotifyMe">Notificarme</option>';
                                        break;
                                    case "arn:aws:automate:us-east-1:ec2:terminate":
                                        html += '<option value="arn:aws:automate:us-east-1:ec2:stop">Detener la instacia</option>'+
                                                '<option selected value="arn:aws:automate:us-east-1:ec2:terminate">Terminar la instacia</option>'+
                                                '<option value="arn:aws:sns:us-east-1:482407636571:NotifyMe">Notificarme</option>';
                                        break;
                                    case "arn:aws:sns:us-east-1:482407636571:NotifyMe":
                                        html += '<option value="arn:aws:automate:us-east-1:ec2:stop">Detener la instacia</option>'+
                                                '<option value="arn:aws:automate:us-east-1:ec2:terminate">Terminar la instacia</option>'+
                                                '<option selected value="arn:aws:sns:us-east-1:482407636571:NotifyMe">Notificarme</option>';
                                        break;
                                }
                                                        
                                html +=             '</select>'+
                                                '</fieldset>'+
                                            '</div>'+
                                            '<div class="col-md-6">'+
                                                '<label>Cuando esta alarma:</label>'+
                                                '<select class="form-control">';

                                if(data._response[i]['OKActions'][0] != null){
                                    html += '<option value="1">Estado de Alarma</option>'+
                                            '<option selected value="2">Estado Ok</option>'+
                                            '<option value="3">Estado Insuficiente</option>';
                                }else if(data._response[i]['AlarmActions'][0] != null){
                                    html += '<option selected value="1">Estado de Alarma</option>'+
                                            '<option value="2">Estado Ok</option>'+
                                            '<option value="3">Estado Insuficiente</option>';
                                }else if(data._response[i]['AlarmActions'][0] != null){
                                    html += '<option value="1">Estado de Alarma</option>'+
                                            '<option value="2">Estado Ok</option>'+
                                            '<option value="3">Estado Insuficiente</option>';
                                }

                                html +=        '</select>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>'+
                                    '<div class="form-group">'+
                                        '<label>Nombre de Alarma:</label>'+
                                        '<input class="form-control" type="text" value="'+data._response[i]['AlarmName']+'"><hr>'+
                                    '</div>'+
                                    '<div class="text-right">'+
                                        '<div class="row">'+
                                            '<div class="col-md-6 text-center">';
                            
                                switch(data._response[i]['StateValue']){
                                    case "OK":
                                        html += '<div class="alert alert-success" role="alert" style="padding:6px; margin: 0;"><i class="glyphicon glyphicon-exclamation-sign"></i> Ok</div>';
                                        break;
                                    case "ALARM":
                                        html += '<div class="alert alert-danger" role="alert" style="padding:6px; margin: 0;"><i class="glyphicon glyphicon-exclamation-sign"></i> Alarma</div>';
                                        break;
                                    case "INSUFFICIENT_DATA":
                                        html += '<div class="alert alert-warning" role="alert" style="padding:6px; margin: 0;"><i class="glyphicon glyphicon-exclamation-sign"></i> Insuficiente</div>';
                                        break;
                                } 

                                html +=         '</div>'+
                                                '<div class="col-md-6">'+
                                                    '<button type="submit" class="btn btn-default"><i class="glyphicon glyphicon-ok"></i> Guardar Alarma</button>'+
                                                '</div>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>';

                                // html += '<div class="well col-md-5 col-md-offset-1"><h4>Historial</h4><div id="history'+ i +'"></div></div>'
                                html += "</div></div>";

                                cpu.append(html);
                                html = "";

                            }else if(data._response[i]['Namespace'] == 'AWS/Billing'){
                                html = '<div class="well col-md-4 init">'+
                                        '<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><br>'+
                                        '<div class="form-group">'+
                                            '<label>Nombre:</label> '+
                                            '<input class="form-control" type="text" value="'+ data._response[i]['AlarmName'] +'"> '+
                                        '</div>'+
                                        '<div class="form-group">'+
                                            '<label>Descripcion:</label> '+
                                            '<input class="form-control" type="text" value="'+data._response[i]['AlarmDescription']+'"> '+
                                        '</div>'+
                                        '<div class="form-group">'+
                                            '<div class="row">'+
                                                '<div class="col-md-6">'+
                                                    '<label>Es:</label> '+
                                                    '<select class="form-control">';
                                switch(data._response[i]['ComparisonOperator']){
                                    case "GreaterThanThreshold":
                                        html += '<option selected value="GreaterThanThreshold">></option><option value="GreaterThanOrEqualToThreshold">>=</option><option value="LessThanThreshold"><</option><option value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                    case "GreaterThanOrEqualToThreshold":
                                        html += '<option value="GreaterThanThreshold">></option><option selected value="GreaterThanOrEqualToThreshold">>=</option><option value="LessThanThreshold"><</option><option value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                    case "LessThanThreshold":
                                        html += '<option value="GreaterThanThreshold">></option><option value="GreaterThanOrEqualToThreshold">>=</option><option selected value="LessThanThreshold"><</option><option value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                    case "LessThanOrEqualToThreshold":
                                        html += '<option value="GreaterThanThreshold">></option><option value="GreaterThanOrEqualToThreshold">>=</option><option value="LessThanThreshold"><</option><option selected value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                }
                                
                                html +=             '</select>'+
                                                '</div>'+
                                                '<div class="col-md-6">'+
                                                    '<label>USD $:</label> '+
                                                    '<input class="form-control" type="text" value="'+ data._response[i]['Threshold'].substring(0,data._response[i]['Threshold'].length-2) +'"> '+
                                                '</div>'+
                                            '</div>'+
                                        '</div>'+
                                        '<div class="form-group">'+
                                        '<div class="row">'+
                                            '<div class="col-md-6">'+
                                                // '<input id="showComboxCpu" type="checkbox"> '+
                                                '<label>Realice la acción:</label>'+
                                                '<fieldset id="changeCombox">'+
                                                    '<select id="disabledSelect" class="form-control">'+
                                                        '<option value="arn:aws:sns:us-east-1:482407636571:NotifyMe">Notificarme</option>'+
                                                    '</select>'+
                                                '</fieldset>'+
                                            '</div>'+
                                            '<div class="col-md-6">'+
                                                '<label>Cuando esta alarma:</label>'+
                                                '<select class="form-control">'+
                                                    '<option value="1">Estado de Alarma</option>'+
                                                    '<option value="2">Estado Ok</option>'+
                                                    '<option value="3">Estado Insuficiente</option>'+
                                                '</select>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>'+
                                        '<div class="text-right">'+
                                            '<div class="row">'+
                                                '<div class="col-md-6 text-center">';

                                                switch(data._response[i]['StateValue']){
                                                    case "OK":
                                                        html += '<div class="alert alert-success" role="alert" style="padding:6px; margin: 0;"><i class="glyphicon glyphicon-exclamation-sign"></i> Ok</div>';
                                                        break;
                                                    case "ALARM":
                                                        html += '<div class="alert alert-danger" role="alert" style="padding:6px; margin: 0;"><i class="glyphicon glyphicon-exclamation-sign"></i> Alarma</div>';
                                                        break;
                                                    case "INSUFFICIENT_DATA":
                                                        html += '<div class="alert alert-warning" role="alert" style="padding:6px; margin: 0;"><i class="glyphicon glyphicon-exclamation-sign"></i> Insuficiente</div>';
                                                        break;
                                                }
                                html +=         '</div>'+
                                            '<div class="col-md-6">'+
                                                '<button type="submit" class="btn btn-default"><i class="glyphicon glyphicon-ok"></i> Guardar Alarma</button>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>';

                                billing.append(html);
                                html = "";
                            }
                            Alarms.history(data._response[i]['AlarmName']);
                        }



                        // cpu.append(
                        //     '<div class="well col-md-4 init">'+
                        //         '<br>'+
                        //         '<div class="form-group">'+
                        //             '<div class="row">'+
                        //                 '<div class="col-md-6">'+
                        //                     '<label>Siempre que sea: </label>'+
                        //                     '<select id="newStatistic" class="form-control">'+
                        //                         '<option value="Average">Promedio</option>'+
                        //                         '<option value="Minimum">Minimo</option>'+
                        //                         '<option value="Maximum">Maximo</option>'+
                        //                         '<option value="Sum">Total</option>'+
                        //                         '<option value="SampleCount">SampleCount</option>'+
                        //                     '</select>'+
                        //                 '</div>'+
                        //                 '<div class="col-md-6">'+
                        //                     '<label>De:</label>'+
                        //                     '<select id="newMetricName" onchange="createNameAlarm()" class="form-control">'+
                        //                         '<option value="CPUUtilization">Consumo de CPU</option>'+
                        //                         '<option value="NetworkOut">Red sin Servicio</option>'+
                        //                         '<option value="DiskReadBytes">Lectura Disco</option>'+
                        //                         '<option value="DiskReadOps">Operaciones Lectura Disco</option>'+
                        //                         '<option value="DiskWriteBytes">Operaciones Escritura Disco</option>'+
                        //                         '<option value="NetworkIn">Red en Servicio</option>'+
                        //                     '</select>'+
                        //                 '</div>'+
                        //             '</div>'+
                        //         '</div>'+
                        //         '<div class="form-group">'+
                        //             '<div class="row">'+
                        //                 '<div class="col-md-6">'+
                        //                     '<label>Es:</label>'+
                        //                     '<select id="newComparisonOperator" class="form-control">'+
                        //                         '<option value="GreaterThanThreshold">></option>'+
                        //                         '<option value="GreaterThanOrEqualToThreshold">>=</option>'+
                        //                         '<option value="LessThanThreshold"><</option>'+
                        //                         '<option value="LessThanOrEqualToThreshold"><=</option>'+
                        //                     '</select>'+
                        //                 '</div>'+
                        //                 '<div class="col-md-6">'+
                        //                     '<label>Porcentaje:</label>'+
                        //                     '<input id="newThreshold" class="form-control" type="text">'+
                        //                 '</div>'+
                        //             '</div>'+  
                        //         '</div>'+
                        //         '<div class="form-group">'+
                        //             '<div class="row">'+
                        //                 '<div class="col-md-6">'+
                        //                     '<label>Por lo menos:</label>'+
                        //                     '<input id="newEvaluationPeriods" class="form-control" type="text">'+
                        //                 '</div>'+
                        //                 '<div class="col-md-6">'+
                        //                     '<label>Período(s) de</label>'+
                        //                     '<select id="newPeriod" class="form-control">'+
                        //                         '<option value="300">5 Minutos</option>'+
                        //                         '<option value="900">15 Minutos</option>'+
                        //                         '<option value="3600">1 Hora</option>'+
                        //                         '<option value="21600">6 Hora</option>'+
                        //                         '<option value="86400">1 Dia</option>'+
                        //                     '</select>'+
                        //                 '</div>'+
                        //             '</div>'+
                        //         '</div>'+
                        //         '<div class="form-group">'+
                        //             '<div class="row">'+
                        //                 '<div class="col-md-6">'+
                        //                     // '<input id="showComboxCpu" type="checkbox"> '+
                        //                     '<label>Realice la acción:</label>'+
                        //                     '<fieldset id="changeCombox">'+
                        //                         '<select id="newActionAlarm" class="form-control">'+
                        //                             '<option value="arn:aws:automate:us-east-1:ec2:stop">Detener la instacia</option>'+
                        //                             '<option value="arn:aws:automate:us-east-1:ec2:terminate">Terminar la instacia</option>'+
                        //                         '</select>'+
                        //                     '</fieldset>'+
                        //                 '</div>'+
                        //                 '<div class="col-md-6">'+
                        //                     '<label>Cuando esta alarma:</label>'+
                        //                     '<select id="newSelectAlarm" class="form-control">'+
                        //                         '<option value="alarm">Estado de Alarma</option>'+
                        //                         '<option value="ok">Estado Ok</option>'+
                        //                         '<option value="insufficient">Estado Insuficiente</option>'+
                        //                     '</select>'+
                        //                 '</div>'+
                        //             '</div>'+
                        //         '</div>'+
                        //         '<div class="form-group">'+
                        //             '<label>Nombre de Alarma:</label>'+
                        //             '<input id="newNameAlarm" class="form-control" type="text" value="awsec2-'+ instanceID +'-CPUUtilization">'+
                        //         '</div>'+
                        //         '<hr>'+
                        //         '<div class="text-right">'+
                        //             '<button onclick="createAlarm(\''+ instanceID +'\')" type="button" class="btn btn-success"><i class="glyphicon glyphicon-dashboard"></i> Crear Alarma</button>'+
                        //         '</div>'+
                        //     '</div>'
                        // );
                    }
                }).error(function (data){
                    $('#stateServices').text('Servicio [Off]');
                    console.log('Servicio [Off]');
                });
            },
            refresh: function () {
                Alarms.load();
                setTimeout(function () {
                    Alarms.refresh();
                    Alarms.history();
                }, 100000);
            },
            history: function(name){
                console.log(name);
                var post = { 'AlarmName': name }

                // uget({
                //     url: LinkServer.Url('alarm', 'getHistory'),
                //     type: 'POST',
                //     data: post
                // }).done(function (data){
                //     alert('Ok');
                // }).error(function (data){
                //     console.log('No hay historial');
                // });
            }
        };

        var Instances = {
            list: {},
            selected: null,
            load: function () {
                uget({
                    url: LinkServer.Url('account', 'instances')
                }).done(function (data) {
                    $('#stateServices').text('Servicio [On]');
                    console.log('Servicio [On]');
                    if(data._code === 200) {
                        var table = $("#table-alarms");
                        
                        //Analizar si hay que borrar una instancia en la lista que tenemos previamente
                        for(var _instanceId in Instances.list) {
                            var sw = false;
                            for(var i=0; i<data._response.length; i++) {
                                sw = (sw)? true : data._response[i].InstanceId == _instanceId;
                            }
                            
                            if(!sw) {
                                table.find("#" + _instanceId).remove();
                                delete Instances.list[_instanceId];
                                console.log("removed " + _instanceId);
                            }
                        }
                        
                        //Analizar las instancias regresadas por el Rest
                        for(var i=0; i<data._response.length; i++) {
                            var tmp = data._response[i];
                            
                            if(Instances.list[tmp.InstanceId]) {
                                var instance = table.find("#" + tmp.InstanceId);
                                
                                instance.find(".i_instance").html(tmp.Name);
                            } else {
                                var tr = $("<tr/>", {
                                    id: tmp.InstanceId,
                                    class: '_alarm'
                                });
                                
                                $("<td/>", {
                                    class: 'i_instance',
                                    html: tmp.Name
                                }).appendTo(tr);

                                $("<td/>", {
                                    class: 'i_name',
                                    html: ''
                                }).appendTo(tr);

                                $("<td/>", {
                                    class: 'i_status text-center'
                                }).html(
                                    $('<button/>',{
                                        class: 'btn btn-success'
                                    }).text('OK')
                                ).appendTo(tr);
                                
                                tr.appendTo(table);
                            }
                            
                            Instances.list[tmp.InstanceId] = {
                                Name : tmp.Name
                            };
                        }
                        
                        if(first) {
                            table.tablesorter();
                            first = false;
                        }
                    }
                }).error(function (data){
                    $('#stateServices').text('Servicio [Off]');
                    console.log('Servicio [Off]');
                });
            },
            refresh: function () {
                Instances.load();
                setTimeout(function () {
                    Instances.refresh();
                }, 10000);
            }
        };

        function showModal(context){
            $('.contex-text').text(context);
            $('#myModal').modal('show');
        }

        $(function () {
            uget({
                url: LinkServer.Url('user', 'active')
            }).done(function (data) {
                if(data._code !== 200) {
                    logout();
                }
            });

            $("#alarms-page").find(".page-header").append(
                $("<a/>", {
                    href: '#',
                    class: 'btn btn-success',
                    html: '<i class="glyphicon glyphicon-dashboard"></i> Crear Alarma'
                }).css({
                    position: 'relative',
                    float: 'right'
                }).click(function (e) {
                    e.preventDefault();
                })
            );
            
            Alarms.refresh();
            // Instances.refresh();
        });


        function logout () {
            uget({
                url     : LinkServer.Url('user', 'logout')
            }).done(function (data) {
                location.href = 'index.html';
            });
        }

        function AlarmAdd (name) {
            var del = { 'AlarmName': name }
            uget({
                url : LinkServer.Url('alarm', 'delete'),
                type: 'DELETE',
                data: del
            }).done(function (data) {
                Alarms.refresh();
            });
        }

        function AlarmDelete (name) {
            var del = { 'AlarmName': name }
            uget({
                url : LinkServer.Url('alarm', 'delete'),
                type: 'DELETE',
                data: del
            }).done(function (data) {
                Alarms.refresh();
            });
        }
    </script>

    <!-- Page-Level Demo Scripts - Blank - Use for reference -->

</body>

</html>
