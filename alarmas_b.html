<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Soluntech - Admin Console</title>

    <!-- Core CSS - Include with every page -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="css/alarmize.jquery.css" />
    <link rel="shortcut icon" type="image/png" href="css/imgs/favicon.png"/>
    <link rel="shortcut icon" type="image/png" href="css/imgs/favicon.png"/>

    <!-- Page-Level Plugin CSS - Blank -->

    <!-- SB Admin CSS - Include with every page -->
    <link href="css/sb-admin.css" rel="stylesheet">

</head>

<body>

    <div id="wrapper">

        <nav class="navbar navbar-default navbar-fixed-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".sidebar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="welcome.html">
                    <h1 id="logo">Soluntech - Console</h1>
                </a>
            </div>
            <!-- /.navbar-header -->

            <ul class="nav navbar-top-links navbar-right">
                <!-- /.dropdown -->
                <li><a id="stateServices">Servicio [On]</a></li>
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i>  <i class="fa fa-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li><a href="profile.html"><i class="fa fa-user fa-fw"></i> Editar Perfil</a>
                        </li>
                        <li><a href="settings.html"><i class="fa fa-gear fa-fw"></i> Configurar</a>
                        </li>
                        <li class="divider"></li>
                        <li><a href="javascript:logout();"><i class="fa fa-sign-out fa-fw"></i> Finalizar Sesión</a>
                        </li>
                    </ul>
                    <!-- /.dropdown-user -->
                </li>
                <!-- /.dropdown -->
            </ul>
            <!-- /.navbar-top-links -->

            <div class="navbar-default navbar-static-side" role="navigation">
                <div class="sidebar-collapse">
                    <ul class="nav" id="side-menu">
                        <li class="sidebar-search">
                            <div class="input-group custom-search-form">
                                <input type="text" class="form-control" placeholder="Search...">
                                <span class="input-group-btn">
                                <button class="btn btn-default" type="button">
                                    <i class="fa fa-search"></i>
                                </button>
                            </span>
                            </div>
                            <!-- /input-group -->
                        </li>
                        <li>
                            <a href="welcome.html"><i class="glyphicon glyphicon-dashboard"></i> Instancias</a>
                            <a href="alarmas.html"><i class="glyphicon glyphicon-flash"></i> Alarmas</a>
                        </li>
                    </ul>
                    <!-- /#side-menu -->
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>

        <div id="page-wrapper">
            <div id="alarms-page">
                <div class="row">
                    <div class="col-lg-12">
                        <h1 class="page-header">Alarmas Programadas</h1>
                    </div>
                    <!-- /.col-lg-12 -->
                </div>
                <!-- /.row -->
                
                <div class="row">
                    <div class="col-lg-12" id="alarmsWork">
                        <ul class="nav nav-tabs" role="tablist">
                            <li class="active"><a href="#cpu" role="tab" data-toggle="tab">Consumo CPU</a></li>
                            <!-- <li><a href="#billing" role="tab" data-toggle="tab">Consumo de Dinero</a></li> -->
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="cpu">

                            </div>
                            <div class="tab-pane" id="billing">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->

    <!-- Modal by Default -->
    <div id="myModal" class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="mySmallModalLabel">Console - Soluntech</h4>
                </div>
                <div class="modal-body">
                    <p class="contex-text"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Ok</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Core Scripts - Include with every page -->
    <script src="js/jquery-1.10.2.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
    <script src="js/jquery.tablesorter.min.js"></script>

    <!-- Page-Level Plugin Scripts - Blank -->

    <script src="js/projectbase.js"></script>

    <!-- SB Admin Scripts - Include with every page -->
    <script src="js/sb-admin.js"></script>
    <script src="js/alarmize.jquery.js"></script>
    
    <script>
        $('#stateServices').text('Servicio [Off]');

        var Alarms = {
            list: {},
            selected: null,
            load: function () {
                uget({
                    url: LinkServer.Url('alarm', 'get')
                }).done(function (data) {
                    $('#stateServices').text('Servicio [On]');
                    console.log('Servicio [On]');
                    if(data._code === 200) {
                        var cpu = $("#cpu");
                        cpu.empty();
                        cpu.append('<br>');

                        var billing = $("#billing");
                        billing.empty();
                        billing.append('<br>');
                        var html = "";

                        for (var i = 0; i <= data._response.length; i++){
                            if(data._response[i]['Namespace'] == 'AWS/EC2'){
                                html = '<div class="well col-md-4 init">'+
                                    '<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><br>'+
                                    '<div class="form-group">'+
                                        '<div class="row">'+
                                            '<div class="col-md-6">'+
                                                '<label>Siempre que sea: </label>'+
                                                '<select class="form-control">';

                                switch(data._response[i]['Statistic']){
                                    case "Average":
                                        html += '<option selected value="Average">Promedio</option>'+
                                                '<option value="Minimum">Minimo</option>'+
                                                '<option value="Maximum">Maximo</option>'+
                                                '<option value="Sum">Total</option>'+
                                                '<option value="SampleCount">SampleCount</option>';
                                        break;
                                    case "Minimum":
                                        html += '<option value="Average">Promedio</option>'+
                                                '<option selected value="Minimum">Minimo</option>'+
                                                '<option value="Maximum">Maximo</option>'+
                                                '<option value="Sum">Total</option>'+
                                                '<option value="SampleCount">SampleCount</option>';
                                        break;
                                    case "Maximum":
                                        html += '<option value="Average">Promedio</option>'+
                                                '<option value="Minimum">Minimo</option>'+
                                                '<option selected value="Maximum">Maximo</option>'+
                                                '<option value="Sum">Total</option>'+
                                                '<option value="SampleCount">SampleCount</option>';
                                        break;
                                    case "Sum":
                                        html += '<option value="Average">Promedio</option>'+
                                                '<option value="Minimum">Minimo</option>'+
                                                '<option value="Maximum">Maximo</option>'+
                                                '<option selected value="Sum">Total</option>'+
                                                '<option value="SampleCount">SampleCount</option>';
                                        break;
                                    case "SampleCount":
                                        html += '<option value="Average">Promedio</option>'+
                                                '<option value="Minimum">Minimo</option>'+
                                                '<option value="Maximum">Maximo</option>'+
                                                '<option value="Sum">Total</option>'+
                                                '<option selected value="SampleCount">SampleCount</option>';
                                        break;
                                }
                                                    
                                html +=         '</select>'+
                                            '</div>'+
                                            '<div class="col-md-6">'+
                                                '<label>De:</label>'+
                                                '<select class="form-control">';
                                switch(data._response[i]['MetricName']){
                                    case "CPUUtilization":
                                        html += '<option selected value="CPUUtilization">Consumo de CPU</option>'+
                                                    '<option value="NetworkOut">Red sin Servicio</option>'+
                                                    '<option value="DiskReadBytes">Lectura Disco</option>'+
                                                    '<option value="DiskReadOps">Operaciones Lectura Disco</option>'+
                                                    '<option value="DiskWriteBytes">Operaciones Escritura Disco</option>'+
                                                    '<option value="NetworkIn">Red en Servicio</option>';
                                        break;
                                    case "NetworkOut":
                                        html += '<option value="CPUUtilization">Consumo de CPU</option>'+
                                                    '<option selected value="NetworkOut">Red sin Servicio</option>'+
                                                    '<option value="DiskReadBytes">Lectura Disco</option>'+
                                                    '<option value="DiskReadOps">Operaciones Lectura Disco</option>'+
                                                    '<option value="DiskWriteBytes">Operaciones Escritura Disco</option>'+
                                                    '<option value="NetworkIn">Red en Servicio</option>';
                                        break;
                                    case "DiskReadBytes":
                                        html += '<option value="CPUUtilization">Consumo de CPU</option>'+
                                                    '<option value="NetworkOut">Red sin Servicio</option>'+
                                                    '<option selected value="DiskReadBytes">Lectura Disco</option>'+
                                                    '<option value="DiskReadOps">Operaciones Lectura Disco</option>'+
                                                    '<option value="DiskWriteBytes">Operaciones Escritura Disco</option>'+
                                                    '<option value="NetworkIn">Red en Servicio</option>';
                                        break;
                                    case "DiskReadOps":
                                        html += '<option value="CPUUtilization">Consumo de CPU</option>'+
                                                    '<option value="NetworkOut">Red sin Servicio</option>'+
                                                    '<option value="DiskReadBytes">Lectura Disco</option>'+
                                                    '<option selected value="DiskReadOps">Operaciones Lectura Disco</option>'+
                                                    '<option value="DiskWriteBytes">Operaciones Escritura Disco</option>'+
                                                    '<option value="NetworkIn">Red en Servicio</option>';
                                        break;
                                    case "DiskWriteBytes":
                                        html += '<option value="CPUUtilization">Consumo de CPU</option>'+
                                                    '<option value="NetworkOut">Red sin Servicio</option>'+
                                                    '<option value="DiskReadBytes">Lectura Disco</option>'+
                                                    '<option value="DiskReadOps">Operaciones Lectura Disco</option>'+
                                                    '<option selected value="DiskWriteBytes">Operaciones Escritura Disco</option>'+
                                                    '<option value="NetworkIn">Red en Servicio</option>';
                                        break;
                                    case "NetworkIn":
                                        html += '<option value="CPUUtilization">Consumo de CPU</option>'+
                                                    '<option value="NetworkOut">Red sin Servicio</option>'+
                                                    '<option value="DiskReadBytes">Lectura Disco</option>'+
                                                    '<option value="DiskReadOps">Operaciones Lectura Disco</option>'+
                                                    '<option value="DiskWriteBytes">Operaciones Escritura Disco</option>'+
                                                    '<option selected value="NetworkIn">Red en Servicio</option>';
                                        break;
                                    default :
                                        html += '<option value="0">No estimado</option>';
                                }


                                html +=         '</select>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>'+
                                    '<div class="form-group">'+
                                        '<div class="row">'+
                                            '<div class="col-md-6">'+
                                                '<label>Es:</label>'+
                                                '<select class="form-control">';

                                switch(data._response[i]['ComparisonOperator']){
                                    case "GreaterThanThreshold":
                                        html += '<option selected value="GreaterThanThreshold">></option><option value="GreaterThanOrEqualToThreshold">>=</option><option value="LessThanThreshold"><</option><option value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                    case "GreaterThanOrEqualToThreshold":
                                        html += '<option value="GreaterThanThreshold">></option><option selected value="GreaterThanOrEqualToThreshold">>=</option><option value="LessThanThreshold"><</option><option value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                    case "LessThanThreshold":
                                        html += '<option value="GreaterThanThreshold">></option><option value="GreaterThanOrEqualToThreshold">>=</option><option selected value="LessThanThreshold"><</option><option value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                    case "LessThanOrEqualToThreshold":
                                        html += '<option value="GreaterThanThreshold">></option><option value="GreaterThanOrEqualToThreshold">>=</option><option value="LessThanThreshold"><</option><option selected value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                }

                                html +=         '</select>'+
                                            '</div>'+
                                            '<div class="col-md-6">'+
                                                '<label>Porcentaje:</label>'+
                                                '<input class="form-control" type="text" value="10">'+
                                            '</div>'+
                                        '</div>'+  
                                    '</div>'+
                                    '<div class="form-group">'+
                                        '<div class="row">'+
                                            '<div class="col-md-6">'+
                                                '<label>Por lo menos:</label><br>'+
                                                '<input class="form-control" type="text" value="1">'+
                                            '</div>'+
                                            '<div class="col-md-6">'+
                                                '<label>Período(s) de</label>'+
                                                '<select class="form-control">'+
                                                    '<option value="300">5 Minutos</option>'+
                                                    '<option value="900">15 Minutos</option>'+
                                                    '<option value="3600">1 Hora</option>'+
                                                    '<option value="21600">6 Hora</option>'+
                                                '</select>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>'+
                                    '<div class="form-group">'+
                                        '<div class="row">'+
                                            '<div class="col-md-6">'+
                                                // '<input id="showComboxCpu" type="checkbox"> '+
                                                '<label>Realice la acción:</label>'+
                                                '<fieldset id="changeCombox">'+
                                                    '<select id="disabledSelect" class="form-control">'+
                                                        '<option value="arn:aws:automate:us-east-1:ec2:stop">Detener la instacia</option>'+
                                                        '<option value="arn:aws:automate:us-east-1:ec2:terminate">Terminar la instacia</option>'+
                                                    '</select>'+
                                                '</fieldset>'+
                                            '</div>'+
                                            '<div class="col-md-6">'+
                                                '<label>Cuando esta alarma:</label>'+
                                                '<select class="form-control">'+
                                                    '<option value="1">Estado de Alarma</option>'+
                                                    '<option value="2">Estado Ok</option>'+
                                                    '<option value="3">Estado Insuficiente</option>'+
                                                '</select>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>'+
                                    '<div class="form-group">'+
                                        '<label>Nombre de Alarma:</label>'+
                                        '<input class="form-control" type="text" value="'+data._response[i]['AlarmName']+'"><hr>'+
                                    '</div>'+
                                    '<div class="text-right">'+
                                        '<div class="row">'+
                                            '<div class="col-md-6 text-center">';
                            
                                switch(data._response[i]['StateValue']){
                                    case "OK":
                                        html += '<div class="alert alert-success" role="alert" style="padding:6px; margin: 0;"><i class="glyphicon glyphicon-exclamation-sign"></i> Ok</div>';
                                        break;
                                    case "ALARM":
                                        html += '<div class="alert alert-danger" role="alert" style="padding:6px; margin: 0;"><i class="glyphicon glyphicon-exclamation-sign"></i> Alarma</div>';
                                        break;
                                    case "INSUFFICIENT_DATA":
                                        html += '<div class="alert alert-warning" role="alert" style="padding:6px; margin: 0;"><i class="glyphicon glyphicon-exclamation-sign"></i> Insuficiente</div>';
                                        break;
                                } 

                                html +=         '</div>'+
                                                '<div class="col-md-6">'+
                                                    '<button type="submit" class="btn btn-default"><i class="glyphicon glyphicon-ok"></i> Guardar Alarma</button>'+
                                                '</div>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>';
                                cpu.append(html);
                                html = "";
                            }else if(data._response[i]['Namespace'] == 'AWS/Billing'){
                                html = '<div class="well col-md-4 init">'+
                                        '<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><br>'+
                                        '<div class="form-group">'+
                                            '<label>Nombre:</label> '+
                                            '<input class="form-control" type="text" value="'+data._response[i]['AlarmName']+'"> '+
                                        '</div>'+
                                        '<div class="form-group">'+
                                            '<label>Descripcion:</label> '+
                                            '<input class="form-control" type="text" value="'+data._response[i]['AlarmDescription']+'"> '+
                                        '</div>'+
                                        '<div class="form-group">'+
                                            '<div class="row">'+
                                                '<div class="col-md-6">'+
                                                    '<label>Es:</label> '+
                                                    '<select class="form-control">';
                                switch(data._response[i]['ComparisonOperator']){
                                    case "GreaterThanThreshold":
                                        html += '<option selected value="GreaterThanThreshold">></option><option value="GreaterThanOrEqualToThreshold">>=</option><option value="LessThanThreshold"><</option><option value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                    case "GreaterThanOrEqualToThreshold":
                                        html += '<option value="GreaterThanThreshold">></option><option selected value="GreaterThanOrEqualToThreshold">>=</option><option value="LessThanThreshold"><</option><option value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                    case "LessThanThreshold":
                                        html += '<option value="GreaterThanThreshold">></option><option value="GreaterThanOrEqualToThreshold">>=</option><option selected value="LessThanThreshold"><</option><option value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                    case "LessThanOrEqualToThreshold":
                                        html += '<option value="GreaterThanThreshold">></option><option value="GreaterThanOrEqualToThreshold">>=</option><option value="LessThanThreshold"><</option><option selected value="LessThanOrEqualToThreshold"><=</option>';
                                        break;
                                }
                                
                                html +=             '</select>'+
                                                '</div>'+
                                                '<div class="col-md-6">'+
                                                    '<label>USD $:</label> '+
                                                    '<input class="form-control" type="text" value="'+data._response[i]['Threshold']+'"> '+
                                                '</div>'+
                                            '</div>'+
                                        '</div>'+
                                        '<div class="form-group">'+
                                        '<div class="row">'+
                                            '<div class="col-md-6">'+
                                                // '<input id="showComboxCpu" type="checkbox"> '+
                                                '<label>Realice la acción:</label>'+
                                                '<fieldset id="changeCombox">'+
                                                    '<select id="disabledSelect" class="form-control">'+
                                                        '<option value="arn:aws:sns:us-east-1:482407636571:NotifyMe">Notificarme</option>'+
                                                    '</select>'+
                                                '</fieldset>'+
                                            '</div>'+
                                            '<div class="col-md-6">'+
                                                '<label>Cuando esta alarma:</label>'+
                                                '<select class="form-control">'+
                                                    '<option value="1">Estado de Alarma</option>'+
                                                    '<option value="2">Estado Ok</option>'+
                                                    '<option value="3">Estado Insuficiente</option>'+
                                                '</select>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>'+
                                        '<div class="text-right">'+
                                            '<div class="row">'+
                                                '<div class="col-md-6 text-center">';

                                                switch(data._response[i]['StateValue']){
                                                    case "OK":
                                                        html += '<div class="alert alert-success" role="alert" style="padding:6px; margin: 0;"><i class="glyphicon glyphicon-exclamation-sign"></i> Ok</div>';
                                                        break;
                                                    case "ALARM":
                                                        html += '<div class="alert alert-danger" role="alert" style="padding:6px; margin: 0;"><i class="glyphicon glyphicon-exclamation-sign"></i> Alarma</div>';
                                                        break;
                                                    case "INSUFFICIENT_DATA":
                                                        html += '<div class="alert alert-warning" role="alert" style="padding:6px; margin: 0;"><i class="glyphicon glyphicon-exclamation-sign"></i> Insuficiente</div>';
                                                        break;
                                                }
                                html +=         '</div>'+
                                            '<div class="col-md-6">'+
                                                '<button type="submit" class="btn btn-default"><i class="glyphicon glyphicon-ok"></i> Guardar Alarma</button>'+
                                            '</div>'+
                                        '</div>'+
                                    '</div>';

                                billing.append(html);
                                html = "";
                            }
                        }

                        cpu.append(
                            '<div class="well col-md-4 init">'+
                                '<br>'+
                                '<div class="form-group">'+
                                    '<div class="row">'+
                                        '<div class="col-md-6">'+
                                            '<label>Siempre que sea: </label>'+
                                            '<select id="newStatistic" class="form-control">'+
                                                '<option value="Average">Promedio</option>'+
                                                '<option value="Minimum">Minimo</option>'+
                                                '<option value="Maximum">Maximo</option>'+
                                                '<option value="Sum">Total</option>'+
                                                '<option value="SampleCount">SampleCount</option>'+
                                            '</select>'+
                                        '</div>'+
                                        '<div class="col-md-6">'+
                                            '<label>De:</label>'+
                                            '<select id="newMetricName" onchange="createNameAlarm()" class="form-control">'+
                                                '<option value="CPUUtilization">Consumo de CPU</option>'+
                                                '<option value="NetworkOut">Red sin Servicio</option>'+
                                                '<option value="DiskReadBytes">Lectura Disco</option>'+
                                                '<option value="DiskReadOps">Operaciones Lectura Disco</option>'+
                                                '<option value="DiskWriteBytes">Operaciones Escritura Disco</option>'+
                                                '<option value="NetworkIn">Red en Servicio</option>'+
                                            '</select>'+
                                        '</div>'+
                                    '</div>'+
                                '</div>'+
                                '<div class="form-group">'+
                                    '<div class="row">'+
                                        '<div class="col-md-6">'+
                                            '<label>Es:</label>'+
                                            '<select id="newComparisonOperator" class="form-control">'+
                                                '<option value="GreaterThanThreshold">></option>'+
                                                '<option value="GreaterThanOrEqualToThreshold">>=</option>'+
                                                '<option value="LessThanThreshold"><</option>'+
                                                '<option value="LessThanOrEqualToThreshold"><=</option>'+
                                            '</select>'+
                                        '</div>'+
                                        '<div class="col-md-6">'+
                                            '<label>Porcentaje:</label>'+
                                            '<input id="newThreshold" class="form-control" type="text">'+
                                        '</div>'+
                                    '</div>'+  
                                '</div>'+
                                '<div class="form-group">'+
                                    '<div class="row">'+
                                        '<div class="col-md-6">'+
                                            '<label>Por lo menos:</label>'+
                                            '<input id="newEvaluationPeriods" class="form-control" type="text">'+
                                        '</div>'+
                                        '<div class="col-md-6">'+
                                            '<label>Período(s) de</label>'+
                                            '<select id="newPeriod" class="form-control">'+
                                                '<option value="300">5 Minutos</option>'+
                                                '<option value="900">15 Minutos</option>'+
                                                '<option value="3600">1 Hora</option>'+
                                                '<option value="21600">6 Hora</option>'+
                                                '<option value="86400">1 Dia</option>'+
                                            '</select>'+
                                        '</div>'+
                                    '</div>'+
                                '</div>'+
                                '<div class="form-group">'+
                                    '<div class="row">'+
                                        '<div class="col-md-6">'+
                                            // '<input id="showComboxCpu" type="checkbox"> '+
                                            '<label>Realice la acción:</label>'+
                                            '<fieldset id="changeCombox">'+
                                                '<select id="newActionAlarm" class="form-control">'+
                                                    '<option value="arn:aws:automate:us-east-1:ec2:stop">Detener la instacia</option>'+
                                                    '<option value="arn:aws:automate:us-east-1:ec2:terminate">Terminar la instacia</option>'+
                                                '</select>'+
                                            '</fieldset>'+
                                        '</div>'+
                                        '<div class="col-md-6">'+
                                            '<label>Cuando esta alarma:</label>'+
                                            '<select id="newSelectAlarm" class="form-control">'+
                                                '<option value="alarm">Estado de Alarma</option>'+
                                                '<option value="ok">Estado Ok</option>'+
                                                '<option value="insufficient">Estado Insuficiente</option>'+
                                            '</select>'+
                                        '</div>'+
                                    '</div>'+
                                '</div>'+
                                '<div class="form-group">'+
                                    '<label>Nombre de Alarma:</label>'+
                                    '<input id="newNameAlarm" class="form-control" type="text" value="awsec2-'+ instanceID +'-CPUUtilization">'+
                                '</div>'+
                                '<hr>'+
                                '<div class="text-right">'+
                                    '<button onclick="createAlarm(\''+ instanceID +'\')" type="button" class="btn btn-success"><i class="glyphicon glyphicon-dashboard"></i> Crear Alarma</button>'+
                                '</div>'+
                            '</div>'
                        );
                    }
                }).error(function (data){
                    $('#stateServices').text('Servicio [Off]');
                    console.log('Servicio [Off]');
                });
            },
            refresh: function () {
                Alarms.load();
                setTimeout(function () {
                    Alarms.refresh();
                }, 10000);
            },
            alarms: function (instanceID, instanceName) {
                Alarms.selected = instanceID;
                
                $("#instances-page").css({
                    display: 'none'
                });
                
                $("#alarms-page").css({
                    display: 'block'
                }).find(".page-header").html(
                    instanceName
                ).append(
                    $("<a/>", {
                        href: '#',
                        html: '[volver]'
                    }).css({
                        'font-size': '0.6em',
                        position: 'relative',
                        float: 'right'
                    }).click(function (e) {
                        e.preventDefault();
                        
                        $("#instances-page").css({
                            display: 'block'
                        });

                        $("#alarms-page").css({
                            display: 'none'
                        });
                    })
                );

                var workflow = $("#cpu");
                workflow.empty();

                $("#cpu").append(
                    '<div class="well col-md-4 init">'+
                        '<br>'+
                        '<div class="form-group">'+
                            '<div class="row">'+
                                '<div class="col-md-6">'+
                                    '<label>Siempre que sea: </label>'+
                                    '<select id="newStatistic" class="form-control">'+
                                        '<option value="Average">Promedio</option>'+
                                        '<option value="Minimum">Minimo</option>'+
                                        '<option value="Maximum">Maximo</option>'+
                                        '<option value="Sum">Total</option>'+
                                        '<option value="SampleCount">SampleCount</option>'+
                                    '</select>'+
                                '</div>'+
                                '<div class="col-md-6">'+
                                    '<label>De:</label>'+
                                    '<select id="newMetricName" onchange="createNameAlarm(\''+ instanceID +'\')" class="form-control">'+
                                        '<option value="CPUUtilization">Consumo de CPU</option>'+
                                        '<option value="NetworkOut">Red sin Servicio</option>'+
                                        '<option value="DiskReadBytes">Red sin Servicio</option>'+
                                        '<option value="DiskReadOps">Red sin Servicio</option>'+
                                        '<option value="DiskWriteBytes">Red sin Servicio</option>'+
                                        '<option value="NetworkIn">Red sin Servicio</option>'+
                                    '</select>'+
                                '</div>'+
                            '</div>'+
                        '</div>'+
                        '<div class="form-group">'+
                            '<div class="row">'+
                                '<div class="col-md-6">'+
                                    '<label>Es:</label>'+
                                    '<select id="newComparisonOperator" class="form-control">'+
                                        '<option value="GreaterThanThreshold">></option>'+
                                        '<option value="GreaterThanOrEqualToThreshold">>=</option>'+
                                        '<option value="LessThanThreshold"><</option>'+
                                        '<option value="LessThanOrEqualToThreshold"><=</option>'+
                                    '</select>'+
                                '</div>'+
                                '<div class="col-md-6">'+
                                    '<label>Porcentaje:</label>'+
                                    '<input id="newThreshold" class="form-control" type="text">'+
                                '</div>'+
                            '</div>'+  
                        '</div>'+
                        '<div class="form-group">'+
                            '<div class="row">'+
                                '<div class="col-md-6">'+
                                    '<label>Por lo menos:</label>'+
                                    '<input id="newEvaluationPeriods" class="form-control" type="text">'+
                                '</div>'+
                                '<div class="col-md-6">'+
                                    '<label>Período(s) de</label>'+
                                    '<select id="newPeriod" class="form-control">'+
                                        '<option value="300">5 Minutos</option>'+
                                        '<option value="900">15 Minutos</option>'+
                                        '<option value="3600">1 Hora</option>'+
                                        '<option value="21600">6 Hora</option>'+
                                        '<option value="86400">1 Dia</option>'+
                                    '</select>'+
                                '</div>'+
                            '</div>'+
                        '</div>'+
                        '<div class="form-group">'+
                            '<div class="row">'+
                                '<div class="col-md-6">'+
                                    // '<input id="showComboxCpu" type="checkbox"> '+
                                    '<label>Realice la acción:</label>'+
                                    '<fieldset id="changeCombox">'+
                                        '<select id="newActionAlarm" class="form-control">'+
                                            '<option value="arn:aws:automate:us-east-1:ec2:stop">Detener la instacia</option>'+
                                            '<option value="arn:aws:automate:us-east-1:ec2:terminate">Terminar la instacia</option>'+
                                        '</select>'+
                                    '</fieldset>'+
                                '</div>'+
                                '<div class="col-md-6">'+
                                    '<label>Cuando esta alarma:</label>'+
                                    '<select id="newSelectAlarm" class="form-control">'+
                                        '<option value="alarm">Estado de Alarma</option>'+
                                        '<option value="ok">Estado Ok</option>'+
                                        '<option value="insufficient">Estado Insuficiente</option>'+
                                    '</select>'+
                                '</div>'+
                            '</div>'+
                        '</div>'+
                        '<div class="form-group">'+
                            '<label>Nombre de Alarma:</label>'+
                            '<input id="newNameAlarm" class="form-control" type="text" value="awsec2-'+ instanceID +'-CPUUtilization">'+
                        '</div>'+
                        '<hr>'+
                        '<div class="text-right">'+
                            '<button onclick="createAlarm(\''+ instanceID +'\')" type="button" class="btn btn-success"><i class="glyphicon glyphicon-dashboard"></i> Crear Alarma</button>'+
                        '</div>'+
                    '</div>'
                );

                var workflow = $("#billing");
                workflow.empty();

                $("#billing").append(
                    '<br><div class="well col-md-4 init">'+
                        '<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><br>'+
                        '<div class="form-group">'+
                            '<label>Nombre:</label> '+
                            '<input class="form-control" type="text" value="EstimatedCharges"> '+
                        '</div>'+
                        '<div class="form-group">'+
                            '<label>Descripcion:</label> '+
                            '<input class="form-control" type="text" value="AWS/Billing"> '+
                        '</div>'+
                        '<div class="form-group">'+
                            '<div class="row">'+
                                '<div class="col-md-6">'+
                                    '<label>Es:</label> '+
                                    '<select class="form-control">'+
                                        '<option value="1">></option>'+
                                        '<option value="2">>=</option>'+
                                        '<option value="3"><</option>'+
                                        '<option value="4"><=</option>'+
                                    '</select>'+
                                '</div>'+
                                '<div class="col-md-6">'+
                                    '<label>USD $:</label> '+
                                    '<input class="form-control" type="text"> '+
                                '</div>'+
                            '</div>'+
                        '</div>'+
                        '<div class="form-group">'+
                            '<label>Cuando esta alarma:</label> '+
                            '<select class="form-control">'+
                                '<option value="1">Estado de Alarma</option>'+
                                '<option value="2">Estado Ok</option>'+
                                '<option value="3">Estado Insuficiente</option>'+
                            '</select>'+
                        '</div>'+
                        '<div class="text-right">'+
                            '<button type="submit" class="btn btn-default"><i class="glyphicon glyphicon-ok"></i> Guardar Alarma</button>'+
                        '</div>'+
                    '</div>'
                );

                $("#billing").append(
                    '<div class="well col-md-4 init">'+
                        '<br>'+
                        '<div class="form-group">'+
                            '<label>Nombre:</label> '+
                            '<input class="form-control" type="text" value="EstimatedCharges"> '+
                        '</div>'+
                        '<div class="form-group">'+
                            '<label>Descripcion:</label> '+
                            '<input class="form-control" type="text" value="AWS/Billing"> '+
                        '</div>'+
                        '<div class="form-group">'+
                            '<div class="row">'+
                                '<div class="col-md-6">'+
                                    '<label>Es:</label> '+
                                    '<select class="form-control">'+
                                        '<option value="1">></option>'+
                                        '<option value="2">>=</option>'+
                                        '<option value="3"><</option>'+
                                        '<option value="4"><=</option>'+
                                    '</select>'+
                                '</div>'+
                                '<div class="col-md-6">'+
                                    '<label>USD $:</label> '+
                                    '<input class="form-control" type="text"> '+
                                '</div>'+
                            '</div>'+
                        '</div>'+
                        '<div class="form-group">'+
                            '<label>Cuando esta alarma:</label> '+
                            '<select class="form-control">'+
                                '<option value="1">Estado de Alarma</option>'+
                                '<option value="2">Estado Ok</option>'+
                                '<option value="3">Estado Insuficiente</option>'+
                            '</select>'+
                        '</div>'+
                        '<div class="text-right">'+
                            '<button type="submit" class="btn btn-success"><i class="glyphicon glyphicon-dashboard"></i> Crear Alarma</button>'+
                        '</div>'+
                    '</div>'
                );
            }
        };

        function showModal(context){
            $('.contex-text').text(context);
            $('#myModal').modal('show');
        }

        function newAlarms (data, prev) {
            var del = {
                instanceID: prev.instanceID,
                _hour: prev.hour + ':' + prev.min
            }

            uget({
                type: 'DELETE',
                url: LinkServer.Url('scheduler', 'delete'),
                data: del
            }).done(function (d) {
                if(d._code == 200) {
                    var params = {
                        instanceID  : prev.instanceID,
                        _hour       : data[0].value + ':' + data[1].value,
                        _action     : data[2].value,
                        days        : []
                    };

                    for(var i in data) {
                        if(data[i].name == 'day') {
                            params.days.push(data[i].value);
                        }
                    }

                    uget({
                        type: 'POST',
                        url: LinkServer.Url('scheduler', 'add'),
                        data: params
                    }).done(function (data) {
                        if(data._code == 200) {
                            showModal('Tareas configuradas');
                            Instances.scheduler(prev.instanceID, prev.instanceName);
                        } else {
                            showModal(data._message);
                        }
                    });
                } else {
                    showModal(data._message);
                }
            });
        }

        function modalConfirm (context, method) {
            $('.modal-footer').html('<button data-dismiss="modal" type="button" class="btn btn-default">Cancel</button><button onclick="modalOk(\''+method+'\')" type="button" class="btn btn-primary">Ok</button>');
            
            showModal(context);
        }

        function modalOk(method){
            console.log( method );
            if(method == 'start'){
                var form = $("#frm-instances");
                var checks = parametrizer(form, true);
                var instancesId = checks.instance.join('|');
                uget({
                    url: LinkServer.Url('instance', 'start', {
                        instanceids: encodeURIComponent(instancesId)
                    })
                }).done(function (data) {
                    if(data._code === 200) {
                        Instances.load();
                    } else {
                        showModal(data._message);
                    }
                });
            }else if(method == 'stop'){
                var form = $("#frm-instances");
                var checks = parametrizer(form, true);
                var instancesId = checks.instance.join('|');
                uget({
                    url: LinkServer.Url('instance', 'stop', {
                        instanceids: encodeURIComponent(instancesId)
                    })
                }).done(function (data) {
                    if(data._code === 200) {
                        Instances.load();
                    } else {
                        showModal(data._message);
                    }
                });
            }else if(method == 'reboot'){
                var form = $("#frm-instances");
                var checks = parametrizer(form, true);
                var instancesId = checks.instance.join('|');
                uget({
                    url: LinkServer.Url('instance', 'reboot', {
                        instanceids: encodeURIComponent(instancesId)
                    })
                }).done(function (data) {
                    if(data._code === 200) {
                        Instances.load();
                    } else {
                        showModal(data._message);
                    }
                });
            }

            $('#myModal').modal('hide');
            $("#table-instances tbody input[type=checkbox]").prop('checked', false);
        }

        function createNameAlarm(instance){
            var str = "";
            $( "#newMetricName option:selected" ).each(function() {
                str += "awsec2-" + instance + "-" + $( this ).val();
                console.log(str);
            });
            $( "#newNameAlarm" ).val( str );
        }
        
        function createAlarm (instance) {
            if (confirm("Desea crear la alarma?") == true) {
                var alarmSelect = $('#newSelectAlarm option:selected').val();
                var a_ok = false;
                var a_alarm = false;
                var a_ins = false;
                switch (alarmSelect) {
                    case 'alarm':
                        a_alarm = true;
                        break;
                    case 'ok':
                        a_ok = true;
                        break;
                    case 'insufficient':
                        a_ins = true;
                        break;
                }


                var params = {
                    AlarmName: $('#newNameAlarm').val(),
                    OKActions: a_ok ? $('#newActionAlarm option:selected').val() : '',
                    AlarmActions: a_alarm ? $('#newActionAlarm option:selected').val() : '',
                    InsufficientDataActions: a_ins ? $('#newActionAlarm option:selected').val() : '',
                    MetricName: $('#newMetricName option:selected').val(),
                    Statistic: $('#newStatistic option:selected').val(),
                    InstanceId: instance,
                    Period: $('#newPeriod option:selected').val(),
                    EvaluationPeriods: $('#newEvaluationPeriods').val(),
                    Threshold: $('#newThreshold').val(),
                    ComparisonOperator: $('#newComparisonOperator option:selected').val()
                }

                uget({
                    url : LinkServer.Url('alarm', 'add'),
                    type: 'POST',
                    data: params
                }).done(function (data) {
                    if(data._code === 200) {
                        alert('Se ha creado la alarma satisfactoriamente.');
                    }else{
                        alert(data._response);
                    }
                });
            }
        }

        $(function () {
            uget({
                url: LinkServer.Url('user', 'active')
            }).done(function (data) {
                if(data._code !== 200) {
                    logout();
                }
            });

            $("#alarms-page").find(".page-header").append(
                $("<a/>", {
                    href: '#',
                    class: 'btn btn-success',
                    html: '<i class="glyphicon glyphicon-dashboard"></i> Crear Alarma'
                }).css({
                    position: 'relative',
                    float: 'right'
                }).click(function (e) {
                    e.preventDefault();
                    
                    $("#instances-page").css({
                        display: 'block'
                    });

                    $("#alarms-page").css({
                        display: 'none'
                    });
                })
            );
            
            Alarms.refresh();
        });


        function logout () {
            uget({
                url     : LinkServer.Url('user', 'logout')
            }).done(function (data) {
                location.href = 'index.html';
            });
        }
    </script>

    <!-- Page-Level Demo Scripts - Blank - Use for reference -->

</body>

</html>
